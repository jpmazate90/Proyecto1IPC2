CREATE SCHEMA CODE_N_BUGS;
USE CODE_N_BUGS;

CREATE TABLE USUARIO(
Usuario VARCHAR(30) NOT NULL,
Contraseña VARCHAR(10) NOT NULL,
Nombre VARCHAR(30) NOT NULL,
Apellido VARCHAR(30) NOT NULL,
Dpi VARCHAR(15) NOT NULL,
Fecha_Ingreso DATE NOT NULL,
Dinero_Hora INT NOT NULL,
Tipo_Usuario VARCHAR(30) NOT NULL,
CONSTRAINT PK_USUARIO PRIMARY KEY(Usuario)
);

CREATE TABLE PROYECTO(
Id INT NOT NULL AUTO_INCREMENT,
Nombre VARCHAR(30) NOT NULL,
Fecha_Limite DATE NOT NULL,
Activo TINYINT(1) NOT NULL,
Administrador_Proyecto VARCHAR(30) NOT NULL,
CONSTRAINT PK_PROYECTO PRIMARY KEY(Id),
CONSTRAINT FK_USUARIO_IN_ADMINISTRADOR_PROYECTO FOREIGN KEY (Administrador_Proyecto) REFERENCES USUARIO(Usuario)
);

CREATE TABLE CASO(
Id INT NOT NULL AUTO_INCREMENT,
Nombre VARCHAR(30) NOT NULL,
Id_Proyecto INT NOT NULL,
Fecha_Limite DATE NOT NULL,
Porcentaje_Avance INT,
Activo TINYINT(1),
Tipo VARCHAR(30),
CONSTRAINT PK_CASO PRIMARY KEY(Id),
CONSTRAINT FK_PROYECTO_IN_ID_PROYECTO FOREIGN KEY (Id_Proyecto) REFERENCES PROYECTO(Id)
);

CREATE TABLE ETAPA(
Id INT NOT NULL AUTO_INCREMENT,
Nombre VARCHAR(30) NOT NULL,
Desarrollador_A_Cargo VARCHAR(30),
Activo TINYINT(1),
Tiempo_En_Horas INT,
Aprobado TINYINT(1),
Fecha_Limite DATE,
Id_Caso INT NOT NULL,
Total INT,
CONSTRAINT PK_PASO PRIMARY KEY(Id),
CONSTRAINT FK_USUARIO_IN_DESARROLLADOR_A_CARGO FOREIGN KEY (Desarrollador_A_Cargo) REFERENCES USUARIO(Usuario),
CONSTRAINT FK_CASO_IN_ID_CASO FOREIGN KEY (Id_Caso) REFERENCES CASO(Id)
);

CREATE TABLE TIPO_CASO(
Nombre VARCHAR(30) NOT NULL,
Etapas INT NOT NULL,
CONSTRAINT PK_TIPO_CASO PRIMARY KEY(Nombre)
);

CREATE TABLE ACCION(
Id INT NOT NULL AUTO_INCREMENT,
Nombre_Usuario VARCHAR(30) NOT NULL,
Id_Proyecto INT NOT NULL,
Id_Caso INT,
Id_Etapa INT,
Fase_Proyecto VARCHAR(30) NOT NULL,
Tipo_Accion VARCHAR(30) NOT NULL,
Comentario VARCHAR(80) NOT NULL,
Aprobado TINYINT(1),
Revisada TINYINT(1),
CONSTRAINT PK_ACCION PRIMARY KEY(Id),
CONSTRAINT FK_PROYECTO_IN_ID_PROYECTO_2 FOREIGN KEY (Id_Proyecto) REFERENCES PROYECTO(Id),
CONSTRAINT FK_CASO_IN_ID_CASO_2 FOREIGN KEY (Id_Caso) REFERENCES CASO(Id),
CONSTRAINT FK_ETAPA_IN_ID_ETAPA_2 FOREIGN KEY (Id_Etapa) REFERENCES ETAPA(Id),
CONSTRAINT FK_USUARIO_IN_NOMBRE_USUARIO_2 FOREIGN KEY (Nombre_Usuario) REFERENCES USUARIO(Usuario)
);


INSERT INTO PROYECTO VALUES ('Proyecto 1','2000-09-09',1,'admin');

INSERT INTO USUARIO(Usuario,Contraseña,Nombre,Apellido,Dpi,Fecha_Ingreso,Dinero_Hora,Tipo_Usuario) VALUES ('admin','1','administrador','base','123456789','2018-09-03',300,'administrador sistema');

